{% extends "base.html" %}

{% block title %}Forum - Climate Community{% endblock %}

{% block content %}
<div class="container">
    <div class="row">
        <div class="col-12">
            <div class="card-glass fade-in mb-4">
                <h1 class="card-title mb-3">
                    <i class="bi bi-chat-dots-fill"></i> Community Forum
                </h1>
                <p class="card-text">Share your experiences, ask questions, and support others in our community</p>
                
                {% if session.get('user_id') %}
                <a href="{{ url_for('create_post') }}" class="btn btn-primary">
                    <i class="bi bi-plus-circle"></i> Create New Post
                </a>
                {% else %}
                <p class="text-muted mt-3">
                    <a href="{{ url_for('login') }}" class="text-decoration-none">Log in</a> to create a post
                </p>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Category Filter -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card-glass fade-in">
                <h5 class="mb-3">Filter by Category</h5>
                <div class="d-flex flex-wrap">
                    <a href="{{ url_for('forum', category='all') }}" 
                       class="category-badge {% if current_category == 'all' %}active{% endif %}">
                        All Posts
                    </a>
                    {% for category in categories %}
                    <a href="{{ url_for('forum', category=category) }}" 
                       class="category-badge {% if current_category == category %}active{% endif %}">
                        {{ category }}
                    </a>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>

    <!-- Posts -->
    <div class="row">
        <div class="col-12">
            {% if posts %}
                {% for post in posts %}
                <div class="post-card fade-in" onclick="window.location='{{ url_for('view_post', post_id=post.id) }}'">
                    <span class="post-category">{{ post.category }}</span>
                    <h3 class="mb-3">{{ post.title }}</h3>
                    <p class="card-text">{{ post.content[:200] }}{% if post.content|length > 200 %}...{% endif %}</p>
                    <div class="post-meta">
                        <span><i class="bi bi-person"></i> {{ post.username }}</span>
                        <span><i class="bi bi-calendar"></i> {{ post.created_at[:10] }}</span>
                        <span><i class="bi bi-heart"></i> {{ post.reaction_count }} reactions</span>
                        <span><i class="bi bi-chat"></i> {{ post.comment_count }} comments</span>
                    </div>
                </div>
                {% endfor %}
            {% else %}
                <div class="card-glass fade-in text-center py-5">
                    <i class="bi bi-inbox" style="font-size: 4rem; color: var(--text-muted);"></i>
                    <h3 class="mt-3">No posts yet</h3>
                    <p class="text-muted">Be the first to share your experience!</p>
                    {% if session.get('user_id') %}
                    <a href="{{ url_for('create_post') }}" class="btn btn-primary mt-3">Create First Post</a>
                    {% endif %}
                </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}

